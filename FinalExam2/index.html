<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">

    <title>Indian Rail </title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');

        * {
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;

        }

        div {
            border: 1px solid;
        }

        .navbar-brand {
            font-weight: 600;

        }

        body {
            background-color: #d3d3d33b;
        }

        .logo {
            height: 25%;
            width: 25%;
            object-fit: contain;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand  " style="margin-left: 45px;" href="#">

                Indian Railways
            </a>
        </div>
    </nav>



    <div class="container ">
        <div class="row py-5">
            <div class="col-3 py-2">
                <div style="text-align: center;">
                    <img class="logo p-1" src="logo.png" />
                </div>
            </div>
            <div class="col-9 py-2">
                <div class="row p-1">
                    <div class="fw-bold">Search Trains</div>
                    <div class="p-1 d-inline-flex  " style="font-size: 12px;">

                        <div><input type="text" id="station1" placeholder="Station Name"></div>
                        <div style="padding-left: 15px;"> <input type="text" id="station2" placeholder="Station Name">
                        </div>

                        <div style="padding-left: 15px;"> <input type="text" class="date-pick" id="datepicker"
                                placeholder="Date"></div>
                        <div style="padding-left: 15px;"> <button type="button" id="searchTrains"
                                class="btn btn-primary">Search</button></div>
                    </div>
                </div>
            </div>
        </div>

        <div>
           
        <div class="mt-1">
            <table id="example" class="table movie-table display" style="width:100%">
                <thead>
                    <tr>
                        <th scope="col" data-column="original_title" data-order="desc">Title</th>
                        <th scope="col" data-column="release_date" data-order="desc">Release Date</th>
                        <th scope="col" data-column="vote_average" data-order="desc">Rating</th>
                        <th scope="col" data-column="popularity" data-order="desc">Popularity</th>
                        <th scope="col" data-column="idx" data-order="desc">Details</th>
  

                    </tr>
                </thead>
                <tbody class="movie-list" id="myTable">


                </tbody>
            </table>

        </div>
        </div>

        <!-- Jquery JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

        <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
        <script>
            $(document).ready(function () {


                var station1_data = [];
                var station2_data = [];
                var date;
                var meta_data = [];

                $("#station1").autocomplete({
                    minLength: 3,
                    source: function (request, response) {
                        var term = request.term;


                        $.ajax({

                            url: `https://indianrailapi.com/api/v2/AutoCompleteStation/apikey/c9b14556386b178bd3170c2a8d2196d7/StationCodeOrName/${term}`,


                            type: "GET",

                            success: function (data) {
                                console.log(`https://indianrailapi.com/api/v2/AutoCompleteStation/apikey/c9b14556386b178bd3170c2a8d2196d7/StationCodeOrName/${term}`)

                                station1_data = []
                                //{ label: "Choice1", value: "value1" }
                                for (let i = 0; i < data.Station.length; i++) {
                                    station1_data.push({
                                        label: data.Station[i].NameEn,
                                        value: data.Station[i].StationCode
                                    })

                                    // station_data.push({ "label": data.Station[i].NameEn, "value": data.Station[i].StationCode })
                                }
                                //console.log('ok', station1_data)
                                response(station1_data);
                            }

                        })

                    }

                });




                $("#station2").autocomplete({
                    minLength: 3,
                    source: function (request, response) {
                        var term = request.term;


                        $.ajax({

                            url: `https://indianrailapi.com/api/v2/AutoCompleteStation/apikey/c9b14556386b178bd3170c2a8d2196d7/StationCodeOrName/${term}`,


                            type: "GET",

                            success: function (data) {

                                station2_data = []
                                //{ label: "Choice1", value: "value1" }
                                for (let i = 0; i < data.Station.length; i++) {
                                    station2_data.push({
                                        label: data.Station[i].NameEn,
                                        value: data.Station[i].StationCode
                                    })

                                    // station_data.push({ "label": data.Station[i].NameEn, "value": data.Station[i].StationCode })
                                }
                                //     console.log('ok', station2_data)
                                response(station2_data);
                            }

                        })

                    }

                });







                $('.date-pick').datepicker({
                    onSelect: function (date) {
                        date = date
                        // console.log(date)
                    },

                    inline: true,

                });



                $('#searchTrains').click(function (e) {
                    e.preventDefault();
                    $('#searchTrains').addClass("desabled")
                    fetch_data();
                });




                function fetch_data() {
                    let fromStationCd = $('#station1').val()
                    let toStationCd = $('#station2').val()
                    let dt = $('#datepicker').val()
                    let x = dt.split("/")
                    x = `${x[2]}${x[0]}${x[1]}`

                    let url1 = `https://indianrailapi.com/api/v2/SeatAvailability/apikey/c9b14556386b178bd3170c2a8d2196d7/From/${fromStationCd}/To/${toStationCd}/Date/${x}/Server/1/Route/1/`


                    $.ajax({
                        url: url1,
                        type: "GET",
                        success: function (data, status, jqXHR) {



                            //   let total_records = data.TotalTrains;

                            if (data.ResponseCode == "200") {

                                meta_data = [];
                                $.each(data.Trains, function (idx, train) {

                                    meta_data.push(
                                        {
                                            'ArrivalTime': train.ArrivalTime,
                                            'AvailabileClass': train.AvailabileClass,
                                            'Availability': train.Availability,
                                            'DepartureTime': train.DepartureTime,
                                            'Destination': train.Destination,
                                            'Source': train.Source,
                                            'TrainName': train.TrainName,
                                            'TrainNo': train.TrainNo

                                        }
                                    )

                                })
                                buildTable(meta_data)

                            }

                            if (data.ResponseCode == "202") {
                                console.log(data.Message)

                            }



                        }



                    });

                }



                function buildTable(data) {

                    var Table = document.getElementById("myTable");
                    Table.innerHTML = "";

                    for (var i = 0; i < data.length; i++) {

                        var html = `  <tr style="line-height: 2px;font-size: 14px;"> \
        <td>${data[i].ArrivalTime}</td>\
        <td>${data[i].AvailabileClass}</td>\
        <td>${data[i].DepartureTime}</td>\
        <td>${data[i].TrainName}</td>\
        <td>${data[i].Availability}</td>\
    </tr>`;
                        Table.innerHTML += html

                    }


                }





            })
        </script>

</body>

</html>