<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">


</head>

<body>

    <nav class="navbar navbar-dark bg-dark">
        <!-- Navbar content -->

        <div class="container">
            <a class="navbar-brand" href="javascript:;">

                <span class="navbar-title" style="font-size: 16px;font-weight: 600;">
                    Internet Movie Database </span>
            </a>

            <div class="ml-auto">

                <button type="button" class="btn btn-primary" style="font-size:14px ;line-height:15px"
                    data-toggle="modal" data-target="#exampleModal">
                    API Info </button>

            </div>


        </div>

    </nav>



    <!-- Button trigger modal -->


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="font-weight: 600;font-size: 16px;" id="exampleModalLabel">API Quota
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="api-status" style="font-size: 14px;line-height: 16px;">0 out of 5 used</div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                            aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>





    <!-- Button trigger modal -->


    <!-- Modal -->
    <div class="modal fade" id="modal-movie" tabindex="-1" role="dialog" aria-labelledby="movie-title"
        aria-hidden="true">
        <div class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="movie-title"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-md-5 movie-img  " style="text-align: center;">

                        </div>
                        <div class="col-md-7">
                            <h6 style="font-weight: 700;">OverView</h6>
                            <div class="overview" style="font-size: 14px;"></div>
                            <div class="d-flex inline mt-3">


                                <span style="font-size: 14px; font-weight: 600;">Realease Date: </span>
                                <div class="release-date ml-1" style="font-size: 14px;"></div>

                            </div>
                            <div class="d-flex inline ">
                                <span style="font-size: 14px; font-weight: 600;">Ratings: </span>
                                <div class="m-ratings" style="font-size: 14px;"></div>

                            </div>

                            <div class="d-flex inline ">
                                <span style="font-size: 14px; font-weight: 600;">Popularity: </span>
                                <div class="m-popularity" style="font-size: 14px;"></div>
                            </div>

                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>


























    <div class="container">



        <div class="row mt-1">
            <div class="col-md-12 search-section">
                <div class="username-label" style="font-size: 14px;font-weight: 600;">
                    Search movies
                </div>
                <div class="row align-items-center mt-1">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="movie-name" placeholder="Search by Movie Name"
                            autofocus="" style="line-height: 1.6;font-size: 1 rem;">
                    </div>
                    <div class="col-md-6">
                        <a href="javascript:;" class="btn btn-sm btn-primary" id="movie-search">Search</a>
                    </div>
                </div>

            </div>
        </div>



        <div class="mt-1">
            <table id="example" class="table movie-table display" style="width:100%">
                <thead>
                    <tr>
                        <th scope="col" data-column="original_title" data-order="desc">Title</th>
                        <th scope="col" data-column="release_date" data-order="desc">Release Date</th>
                        <th scope="col" data-column="vote_average" data-order="desc">Rating</th>
                        <th scope="col" data-column="popularity" data-order="desc">Popularity</th>
                        <th scope="col" data-column="idx" data-order="desc">Details</th>
  

                    </tr>
                </thead>
                <tbody class="movie-list" id="myTable">


                </tbody>
            </table>

        </div>
        <nav aria-label="Page navigation example">
            <ul class="pagination">


            </ul>
        </nav>



    </div>






    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {

            var my_table_data = []
            var api_call = 0;
            var meta_data;
            var page_no = 1;
            var pages;
            var total_records;

            $('.movie-table').hide();

            $('#movie-search').click(function (e) {
                e.preventDefault();
                fetch_data();
            });

            function fetch_data() {

                $('.movie-table').show();
                var movieName = $("#movie-name").val();
                $('.movie-list').empty();
                var api_key1 = 'feb6f0eeaa0a72662967d77079850353';
                /*
                var uri = `https://api.themoviedb.org/3/search/movie?api_key=${api_key1}&query=${movieName}&`;
                $.get(uri, function (data) {
                    console.log(uri)
                    console.log(data)
                    meta_data = data.results;
                    $.each(meta_data, function (idx, movie) {
                        var html = `  <tr> \
                        <td>${movie.original_title}</td>\movie.release_date
                        <td><a href='javascript:;' class='movie-details' data-id='${idx}'  data-toggle="modal" data-target="#modal-movie">Details</a></td>\
                    </tr>`;
                        $(".movie-list").append(html);
                    })
                }) */

                $.ajax({
                    url: 'https://api.themoviedb.org/3/search/movie',
                    type: "GET",
                    data: {
                        api_key: api_key1,
                        query: movieName,
                        page: page_no

                    },
                    success: function (data) {
                        api_call++;
                        $(".pagination").show()
                        meta_data = data.results;
                        pages = data.total_pages;
                        total_records = data.total_results;
                        console.log(data)
                        console.log(pages, total_records)
                        my_table_data = []

                        $.each(meta_data, function (idx, movie) {
                            my_table_data.push({ 'original_title': movie.original_title, 'release_date': movie.release_date, 'vote_average': movie.vote_average, 'popularity': movie.popularity, 'id': idx })
                        })


                        buildTable(my_table_data)

                        pagination()

                        progress_bar()




                    }



                });
            }


            function buildTable(data) {

                var Table = document.getElementById("myTable");
                Table.innerHTML = "";

                for (var i = 0; i < data.length; i++) {

                    var html = `  <tr style="line-height: 2px;font-size: 14px;"> \
                        <td>${data[i].original_title}</td>\
                        <td>${data[i].release_date}</td>\
                        <td>${data[i].vote_average}</td>\
                        <td>${data[i].popularity}</td>\
                        <td><a href='javascript:;' class='movie-details' data-id='${data[i].id}'  data-toggle="modal" data-target="#modal-movie">Details</a></td>\
                    </tr>`;
                    Table.innerHTML += html

                }


            }



            function pagination() {

                $(".pagination").empty()
                var html = `<li class="page-item Previous"><a class="page-link " href="javascript:;">Previous</a></li>`
                $(".pagination").append(html);

                for (let i = 1; i <= pages; i++) {

                    if (i == page_no) {
                        html = `<li class="page-item active"><a class="page-link page-no " data-id="${i}" href="javascript:;">${i}</a></li>`
                        $(".pagination").append(html);


                    } else {
                        html = `<li class="page-item"><a class="page-link page-no" data-id="${i}" href="javascript:;">${i}</a></li>`
                        $(".pagination").append(html);
                    }
                }

                html = `<li class="page-item Next"><a class="page-link " href="javascript:;">Next</a></li>`
                $(".pagination").append(html);

                if (page_no == 1) {
                    $(".Previous").addClass("disabled")
                } else {
                    $(".Previous").removeClass("disabled")

                }

                if (page_no == pages) {
                    $(".Next").addClass("disabled")
                } else {
                    $(".Next").removeClass("disabled")

                }



            }

            function progress_bar() {
                $(".progress").empty();

                if (api_call <= 5) {
                    var per = api_call * 100 / 5
                    var x = `${api_call} out of 5 used`;
                    $(".api-status").text(x);
                    html = `<div class="progress-bar" role="progressbar" style="width: ${per}%" aria-valuenow="${per}" aria-valuemin="0" aria-valuemax="100"></div>`
                    $(".progress").append(html);

                }

                if (api_call > 5) {
                    var x = `You have Reached API rate limit. Please Consider Upgrading`;
                    $(".api-status").text(x);
                    $("#exampleModalLabel").text("API Quota Reached")
                    $(".progress").hide()
                    $('#exampleModal').modal('show');

                }
            }

            $(document).on('click', '.movie-details', function (e) {

                e.preventDefault();
                $(".movie-img").empty()
                var idx = parseInt($(this).data("id"));
                console.log(meta_data[idx]);
                $('#movie-title').text(meta_data[idx].original_title)
                var html1 = `  <img  src='https://image.tmdb.org/t/p/w200${meta_data[idx].poster_path}' class='avatar-url'></img>`
                $(".movie-img").append(html1);
                $(".overview").text(meta_data[idx].overview)
                $(".release-date").text(meta_data[idx].release_date)

                $(".m-ratings").text(meta_data[idx].vote_average)
                $(".m-popularity").text(meta_data[idx].popularity)
            });



            $(document).on('click', '.Previous', function (e) {

                if (page_no > 1) {
                    page_no--;

                    fetch_data();

                }



            });

            $(document).on('click', '.Next', function (e) {

                if (page_no < pages) {
                    page_no++;

                    fetch_data();

                }



            });


            $(document).on('click', '.page-no', function (e) {
                page_no = $(this).data("id")

                $(this).addClass("active")


                fetch_data();

            });






            $(document).on('click', 'th', function (e) {
                var column = $(this).data('column')
                var order = $(this).data('order')

                console.log(column,order)

                if(order == 'desc'){
                    $(this).data('order','asc')
                my_table_data.sort((a, b) => {
                    let fa = a[column],
                        fb = b[column];
                        console.log(fa,fb)

                    if (fa < fb) {
                        return -1;
                    }
                    if (fa > fb) {
                        return 1;
                    }
                    return 0;
                });

            }else{
                $(this).data('order','desc')
                my_table_data.sort((a, b) => {
                    let fa = a[column],
                        fb = b[column];
                        console.log(fa,fb)

                    if (fa > fb) {
                        return -1;
                    }
                    if (fa < fb) {
                        return 1;
                    }
                    return 0;
                });

            }




                buildTable(my_table_data)



            });











        });
    </script>
</body>

</html>